<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.function.sysfunction.dao.SysFunctionDao">
	 
	 <resultMap type="map" id="sysfunction">
			<result property="id" column="function_id"/>
			<result property="pId" column="parent_id"/>
			<result property="name" column="function_name"/>
			<result property="open" column="is_open"/>
			<result property="remark" column="remark"/>
			<result property="desc" column="function_desc"/>
			<result property="nameshow" column="function_nameshow"/>
			
	</resultMap>
	<select id="getList" resultMap="sysfunction" parameterType="map">
		select function_id,
		       function_id||'-'||function_name function_nameshow,
		       function_name,
		       function_desc,
		       parent_id,
 		       remark,
		       is_deleted,
		       create_time,
		       last_update_time,
		       IS_OPEN
  		from sys_function t
		<where>	 
			 <if test="functionId!='' and functionId!=null">
			 	function_id=${functionId}
			 </if>
		 </where>
		 order by function_id
	</select>
	<select id="getlistByParentId" resultMap="sysfunction" parameterType="map">
		select function_id,
		       function_id||'-'||function_name function_nameshow,
		       function_name,
		       function_desc,
		       parent_id,
 		       remark,
		       is_deleted,
		       create_time,
		       last_update_time,
		       IS_OPEN
  		from sys_function t
		<where>	 
			 <if test="parentFunctionId!='' and parentFunctionId!=null">
			 	parent_id=${parentFunctionId}
			 </if>
		</where>
		 order by function_id
	</select>
	<select id="getMaxFunctionIdByPId" resultType="string" parameterType="map">
	
		select  max(function_id) from sys_function t where  t.parent_id='${pId}'
	</select>
	<insert id="add" parameterType="map">
	
		insert into sys_function
						  (function_id,
						   function_name,
						   function_desc,
						   parent_id,
 						   remark,
						   is_deleted,
						   create_time,
						   last_update_time,
						   is_open)
					values
						  ('${id}',
						   '${name}',
						   '${desc}',
						   '${pId}',
 						   '${remark}',
						   '0',
						   '${createTime}',
						   '${createTime}',
						   0)
	</insert>
	<update id="update" parameterType="map">
			update sys_function
			   set function_name = '${name}',
			       function_desc = '${desc}',
			       remark        = '${remark}',
			       last_update_time = '${updateTime}'
			 where function_id = '${id}'
 	</update>
</mapper>